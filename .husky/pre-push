#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ§ª Running E2E tests before push..."

# Run all chromium E2E tests (excludes performance tests which need headed mode)
echo "Running core E2E tests..."
npm run test:e2e -- --project=chromium --grep-invert "keyboard-shortcuts.spec.js" --timeout=120000 --reporter=line

if [ $? -ne 0 ]; then
  echo "âŒ Core E2E tests failed. Push aborted."
  echo "ğŸ’¡ Fix the failing tests or use --no-verify to skip this check."
  exit 1
fi

# Run only critical keyboard shortcuts tests (from keyboard-shortcuts.spec.js file)
echo "Running critical keyboard shortcuts tests..."
npm run test:e2e -- --project=chromium keyboard-shortcuts.spec.js --grep "@critical" --timeout=120000 --reporter=line

if [ $? -ne 0 ]; then
  echo "âŒ Critical keyboard shortcuts tests failed. Push aborted."
  echo "ğŸ’¡ Fix the failing tests or use --no-verify to skip this check."
  exit 1
fi

echo "âœ… All E2E tests passed!"
echo "ğŸ’¡ Run 'npm run test:e2e' to execute the full test suite including all keyboard shortcut tests"
echo "ğŸ’¡ Run 'npx playwright test --project=performance' for GPU performance tests (requires headed mode)"
